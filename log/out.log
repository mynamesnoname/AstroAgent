2025-12-02 21:52:00,563 [INFO] âœ… ä½¿ç”¨é…ç½®æ–‡ä»¶: /home/wbc/code/llm-spectro-agent/mcp_config.json
2025-12-02 21:52:00,704 [INFO] ğŸš€ æ‰¹é‡åˆ†ææ¨¡å¼: 1 â†’ 40
2025-12-02 21:52:00,704 [WARNING] âš ï¸ è·³è¿‡ï¼šæ–‡ä»¶ä¸å­˜åœ¨ - /home/wbc/code/llm-spectro-agent/data/test_set_2/A/input/001.png
2025-12-02 21:52:00,704 [INFO] ğŸš€ æ‰¹é‡åˆ†ææ¨¡å¼: 1 â†’ 40
2025-12-02 21:52:00,704 [INFO] â¡ï¸ å¼€å§‹åˆ†æç¬¬ 2/40 å¼ å›¾åƒ: 002.png
2025-12-02 21:52:12,181 [INFO] HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-02 21:52:38,676 [INFO] HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-02 21:53:10,240 [INFO] HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
Processing request of type ListToolsRequest
2025-12-02 21:53:13,070 [INFO] HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-02 21:53:14,525 [INFO] HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-02 21:53:18,645 [INFO] HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-02 21:53:24,728 [INFO] HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
Traceback (most recent call last):
  File "/home/wbc/code/llm-spectro-agent/src/astro_agents.py", line 1729, in run
    plot_merged_features(state)
  File "/home/wbc/code/llm-spectro-agent/src/utils.py", line 1153, in plot_merged_features
    peaks_to_plot = min(plot_peaks, len(state['cleaned_peaks']))
                                        ~~~~~^^^^^^^^^^^^^^^^^
KeyError: 'cleaned_peaks'
2025-12-02 21:53:24,753 [INFO] âœ… å›¾åƒ 002.png åˆ†æå®Œæˆ
2025-12-02 21:53:24,753 [INFO] ğŸš€ æ‰¹é‡åˆ†ææ¨¡å¼: 1 â†’ 40
2025-12-02 21:53:24,753 [INFO] â¡ï¸ å¼€å§‹åˆ†æç¬¬ 3/40 å¼ å›¾åƒ: 003.png
2025-12-02 21:53:28,398 [INFO] âœ… å›¾åƒ 003.png åˆ†æå®Œæˆ
2025-12-02 21:53:28,399 [INFO] ğŸš€ æ‰¹é‡åˆ†ææ¨¡å¼: 1 â†’ 40
2025-12-02 21:53:28,399 [INFO] â¡ï¸ å¼€å§‹åˆ†æç¬¬ 4/40 å¼ å›¾åƒ: 004.png
2025-12-02 21:53:28,623 [INFO] âœ… å›¾åƒ 004.png åˆ†æå®Œæˆ
2025-12-02 21:53:28,623 [INFO] ğŸš€ æ‰¹é‡åˆ†ææ¨¡å¼: 1 â†’ 40
2025-12-02 21:53:28,624 [WARNING] âš ï¸ è·³è¿‡ï¼šæ–‡ä»¶ä¸å­˜åœ¨ - /home/wbc/code/llm-spectro-agent/data/test_set_2/A/input/005.png
2025-12-02 21:53:28,624 [INFO] ğŸš€ æ‰¹é‡åˆ†ææ¨¡å¼: 1 â†’ 40
2025-12-02 21:53:28,624 [INFO] â¡ï¸ å¼€å§‹åˆ†æç¬¬ 6/40 å¼ å›¾åƒ: 006.png
âœ… é…ç½®æ–‡ä»¶åŠ è½½æˆåŠŸ: /home/wbc/code/llm-spectro-agent/mcp_config.json
[LLM INIT] LLM -> model=qwen3-max-2025-09-23, temp=0.1, max_tokens=None, base_url=https://dashscope.aliyuncs.com/compatible-mode/v1
[LLM INIT] VIS_LLM -> model=qwen-vl-max-2025-08-13, temp=0.1, max_tokens=None, base_url=https://dashscope.aliyuncs.com/compatible-mode/v1
âœ… MCPç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
æ™ºèƒ½ä½“ Spectral Visual Interpreter åˆå§‹åŒ–å®Œæˆ
æ™ºèƒ½ä½“ Spectral Rule Analyst åˆå§‹åŒ–å®Œæˆ
æ™ºèƒ½ä½“ Spectral Analysis Auditor åˆå§‹åŒ–å®Œæˆ
æ™ºèƒ½ä½“ Spectral Refinement Assistant åˆå§‹åŒ–å®Œæˆ
æ™ºèƒ½ä½“ Spectral Synthesis Host åˆå§‹åŒ–å®Œæˆ
åˆå§‹åŒ–äº† 5 ä¸ªæ™ºèƒ½ä½“
ğŸš€ å·¥ä½œæµç¼–æ’å™¨åˆå§‹åŒ–å®Œæˆ
âœ… MCP å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ
âœ… å·¥ä½œæµç¼–æ’å™¨åˆå§‹åŒ–æˆåŠŸ
ğŸš€ Start MCP LLM Spectro Agent
ğŸ” åˆ†æè®¾ç½® - æ³¢æ®µåç§°: None, æ³¢æ®µæ³¢é•¿: None
Stage 1: Visual Interpreter
æ™ºèƒ½ä½“ Spectral Visual Interpreter å®ä¾‹åˆ›å»ºå®Œæˆ
cropped image is saved to /home/wbc/code/llm-spectro-agent/data/test_set_2/A/output/002_cropped.png
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Using sigma list: [0, 2, 4, 16]
Detected 36 peaks and 33 troughs.
Stage 2: Rule Analyst
æ™ºèƒ½ä½“ Spectral Rule Analyst å®ä¾‹åˆ›å»ºå®Œæˆ
finished describe_spectrum_picture
âŒ An error occurred during spectral analysis:
Error type: KeyError
Error message: 'cleaned_peaks'
Full traceback:
âŒ åˆ†ææµç¨‹å¤±è´¥: 'cleaned_peaks'
yes
yes
yes
yes
ğŸš€ Start MCP LLM Spectro Agent
ğŸ” åˆ†æè®¾ç½® - æ³¢æ®µåç§°: None, æ³¢æ®µæ³¢é•¿: None
Stage 1: Visual Interpreter
âš ï¸ åˆ†ææµç¨‹å·²å–æ¶ˆ: 
yes
yes
yes
yes
ğŸš€ Start MCP LLM Spectro Agent
ğŸ” åˆ†æè®¾ç½® - æ³¢æ®µåç§°: None, æ³¢æ®µæ³¢é•¿: None
Stage 1: Visual Interpreter
âš ï¸ åˆ†ææµç¨‹å·²å–æ¶ˆ: 
yes
yes
yes
yes
ğŸš€ Start MCP LLM Spectro Agent
ğŸ” åˆ†æè®¾ç½® - æ³¢æ®µåç§°: None, æ³¢æ®µæ³¢é•¿: None
Stage 1: Visual Interpreter
Traceback (most recent call last):
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/base_events.py", line 1961, in _run_once
    event_list = self._selector.select(timeout)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/selectors.py", line 468, in select
    fd_event_list = self._selector.poll(timeout, max_ev)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/runners.py", line 157, in _on_sigint
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/wbc/code/llm-spectro-agent/main.py", line 137, in <module>
    asyncio.run(main())
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/runners.py", line 194, in run
    with Runner(debug=debug, loop_factory=loop_factory) as runner:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/runners.py", line 62, in __exit__
    self.close()
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/runners.py", line 70, in close
    _cancel_all_tasks(loop)
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/runners.py", line 206, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/asyncio/base_events.py", line 1961, in _run_once
    event_list = self._selector.select(timeout)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wbc/apps/anaconda3/envs/langchain/lib/python3.12/selectors.py", line 468, in select
    fd_event_list = self._selector.poll(timeout, max_ev)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt
